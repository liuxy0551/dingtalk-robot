var e=Object.defineProperty,o=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(o,n,a)=>n in o?e(o,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[n]=a;import{n as i,o as r,m as c,t as d,D as m,r as f,c as y,d as p,F as g,q as I,s as h,w as u,p as v,a as C,b,v as k,e as w}from"./vendor.e2c80a0b.js";import{a as S}from"./index.aa2c98da.js";import{g as j}from"./index.50dbc49c.js";const L={setup(){const e=localStorage.getItem("senderId"),f=localStorage.getItem("moneyInfoCodes"),y=i({typeConfirmVisible:!1,typeActions:[{name:"基金",value:"jijin"},{name:"A股",value:"gupiao"},{name:"港股",value:"gupiao",locale:"ganggu"}],moneyInfo:null,keyword:"",result:[],moneyInfoCodeList:[],showRefresh:!1,refreshing:!1});r((()=>{f&&(y.moneyInfoCodeList=f.split(",")),p()}));const p=()=>{const e=j();localStorage.getItem("version")!==e&&(localStorage.setItem("version",e),c(`当前版本：${e}`))};return g=((e,o)=>{for(var n in o||(o={}))t.call(o,n)&&l(e,n,o[n]);if(a)for(var n of a(o))s.call(o,n)&&l(e,n,o[n]);return e})({senderId:e},d(y)),o(g,n({onSearch:e=>{c.loading({message:"加载中...",forbidClick:!0,loadingType:"spinner"}),S.post("/api/getMoneyInfoBySina",{key:e}).then((e=>{e.data.split(";")[0].length<25&&(y.result=[],c("查无结果"));let o=[];e.data.split(";").forEach((e=>{e=e.split(","),o.push({code:e[3],codeB:e[2],name:e[6],selected:y.moneyInfoCodeList.includes(e[2])||y.moneyInfoCodeList.includes(e[3]),loading:!1})})),y.result=o})).finally((()=>{c.clear()}))},showConfirm:e=>{y.moneyInfo=e,y.typeConfirmVisible=!0},createMoneyInfo:o=>{y.moneyInfo.loading=!0;const n=y.moneyInfo["jijin"===o.value?"codeB":"code"],a={senderId:e,type:o.value,name:y.moneyInfo.name,code:"ganggu"===o.locale?`hk${n}`:n,sort:y.moneyInfoCodeList.length};S.post("/api/createMoneyInfo",a).then((()=>{y.moneyInfoCodeList.push(a.code),localStorage.setItem("moneyInfoCodes",y.moneyInfoCodeList.join(",")),c("添加成功"),y.moneyInfo.selected=!0})).finally((()=>{y.moneyInfo.loading=!1}))},deleteMoneyInfo:o=>{o.loading=!0,m.confirm({title:"删除自选",message:"确认删除该自选理财信息吗？"}).then((()=>{const n=y.moneyInfoCodeList.some((e=>e===o.code)),a={senderId:e,code:o[n?"code":"codeB"]};S.post("/api/deleteMoneyInfo",a).then((()=>{y.moneyInfoCodeList.splice(y.moneyInfoCodeList.indexOf(o[n?"code":"codeB"]),1),localStorage.setItem("moneyInfoCodes",y.moneyInfoCodeList.join(",")),c("删除成功"),o.selected=!1})).finally((()=>{o.loading=!1}))})).catch((()=>{o.loading=!1}))},refreshAPP:()=>{y.refreshing=!0,localStorage.removeItem("version"),location.reload(),setTimeout((()=>{y.refreshing=!1}),2500)}}));var g}},P=u();v("data-v-8680d9c2");const O={class:"money-content"},x={class:"top-search"},V={class:"box"},M={key:0,class:"row"},A={class:"text"},B=w("添加自选"),_=w("删除自选");C();const U=P(((e,o,n,a,t,s)=>{const l=f("van-search"),i=f("van-button"),r=f("van-icon"),c=f("van-action-sheet");return b(),y("div",O,[p("div",x,[p(l,{modelValue:e.keyword,"onUpdate:modelValue":[o[1]||(o[1]=o=>e.keyword=o),a.onSearch],placeholder:"请输入简称/拼音/代码",onSearch:a.onSearch},null,8,["modelValue","onSearch","onUpdate:modelValue"])]),p("div",V,[(b(!0),y(g,null,I(e.result,(e=>(b(),y("div",{class:"item",key:e.code},[e.code&&e.name?(b(),y("div",M,[p("div",A,k(e.code)+" - "+k(e.name),1),e.selected?(b(),y(i,{key:1,type:"warning",size:"mini",loading:e.loading,onClick:o=>a.deleteMoneyInfo(e)},{default:P((()=>[_])),_:2},1032,["loading","onClick"])):(b(),y(i,{key:0,type:"primary",size:"mini",loading:e.loading,onClick:o=>a.showConfirm(e)},{default:P((()=>[B])),_:2},1032,["loading","onClick"]))])):h("",!0)])))),128))]),e.showRefresh?(b(),y("div",{key:0,class:["refresh-box",{loading:e.refreshing}],onClick:o[2]||(o[2]=(...e)=>a.refreshAPP&&a.refreshAPP(...e))},[p(r,{name:"replay"})],2)):h("",!0),p(c,{show:e.typeConfirmVisible,"onUpdate:show":o[3]||(o[3]=o=>e.typeConfirmVisible=o),actions:e.typeActions,"cancel-text":"取消","close-on-click-action":"",onSelect:a.createMoneyInfo,title:"选择理财类型"},null,8,["show","actions","onSelect"])])}));L.render=U,L.__scopeId="data-v-8680d9c2";export default L;
